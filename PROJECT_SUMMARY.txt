Feishu RSS Digest 项目说明（概览版）

1) 项目定位
- 这是一个“RSS → 结构化资讯”的自动化工具。
- 用户把 RSS 源维护在飞书多维表中，系统会按计划抓取并生成分类、评分、摘要、要点，写入新闻主表。
- 支持精确去重，可选 Cloudflare Vectorize 近似去重。
- 支持 LLM 摘要（默认 Gemini，也可切换 iFlow/OpenAI 兼容接口）。
- 支持失败提醒（多维表“提醒记录”表 + 飞书自动化通知）。

2) 核心流程（运行顺序）
- 读取 RSS 源表 → 按 last_item_pub_time / last_fetch_time 增量抓取
- 精确去重（主表预取 item_key） → 可选 Vectorize 近似去重
- LLM 生成 JSON 结构化内容（分类/分数/标题/要点）
- 写入新闻主表
- 更新 RSS 源表状态字段
- 若触发错误（鉴权/限流/5xx/超时/解析/关键配置缺失），写入提醒记录表

3) 主要脚本说明
- rss_ingest.py：主流程，抓取 + LLM 分析 + 去重 + 写入
- rss_parser.py：RSS 拉取与解析
- feishu_client.py：飞书 Bitable API 封装
- rss_bootstrap.py：初始化 RSS 源表字段、导入订阅（按需）
- rss_field_cleanup.py：清理旧字段（按需）
- config.py：全部环境变量与字段映射配置

4) 目录与文件
- .github/workflows/rss-ingest.yml：定时运行抓取任务
- .github/workflows/create-vectorize-index.yml：创建 Vectorize 索引
- requirements.txt：Python 依赖（requests, feedparser）
- README.md：面向用户的详细部署说明

5) 必要环境变量（最小可运行）
- 飞书基础：
  FEISHU_APP_ID
  FEISHU_APP_SECRET
  FEISHU_APP_TOKEN
  FEISHU_NEWS_TABLE_ID
  FEISHU_RSS_TABLE_ID
- LLM（二选一）：
  GEMINI_API_KEY
  或 LLM_PROVIDER=iflow + IFLOW_API_KEY

6) 常用可选环境变量
- LLM：
  GEMINI_MODEL_NAME
  IFLOW_MODEL / IFLOW_BASE_URL / IFLOW_TIMEOUT / IFLOW_RETRIES
  SYSTEM_PROMPT_OVERRIDE（覆盖默认提示词）
- Vectorize：
  CF_API_TOKEN / CF_ACCOUNT_ID / CF_VECTORIZE_INDEX
  CF_VECTORIZE_TOP_K / CF_VECTORIZE_SIM_THRESHOLD
- 提醒记录表：
  FEISHU_NOTIFY_TABLE_ID
  NOTIFY_FIELD_EVENT / NOTIFY_FIELD_DETAIL / NOTIFY_FIELD_PLAIN /
  NOTIFY_FIELD_TRIGGER_TIME / NOTIFY_FIELD_NOTIFIED

7) 多维表字段要求（简要）
- RSS 源表：name, feed_url, enabled, status, last_fetch_time, last_item_pub_time 等
- 新闻主表：标题, AI打分, 分类, 总结, 发布时间, 来源, 全文, item_key
- 提醒记录表（可选）：事件, 详情, 说明, 触发时间, 已通知

8) 提醒机制（默认触发类型）
- 鉴权失败（401/403 或缺 Key）
- 限流/配额不足（429）
- 上游服务异常（5xx）
- 网络超时
- 输出解析失败
- 关键配置缺失
说明字段会写入“人话提示”，便于非技术用户理解。

9) LLM 提示词与结构化输出
- 提示词在 rss_ingest.py 的 SYSTEM_PROMPT 中
- 可用 SYSTEM_PROMPT_OVERRIDE 覆盖
- 输出格式要求为 JSON（categories/score/title_zh/one_liner/points）

10) GitHub Actions 使用方式
- rss-ingest：定时运行抓取
- create-vectorize-index：创建 Vectorize 索引（一次性）
- Secrets 统一在仓库 Settings → Secrets and variables → Actions 配置

11) 常见问题简述
- 401/403：密钥无效或权限不足
- 429：限流或配额不足
- 5xx：上游服务异常
- RSS 403：源站拦截
- 内网 RSS：GitHub Actions 无法访问

12) 维护建议
- RSS 源表定期清理无效源
- 若启用 Vectorize，请确保索引名与配置一致
- 配置变更建议先本地验证再上线
